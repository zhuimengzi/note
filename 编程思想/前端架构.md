## 前端架构

很多人觉得模块化开发的工程意义是复用，我不太认可这种看法，在我看来，模块化开发的最大价值应该是分治，是分治，分治。

### 关于前端工程的核心问题

说的有点大，其实呢，前端工程只有两个核心问题：

> 一个是 `资源定位`，另一个是 `模块化开发`。

前端工程的所有工作都是围绕着这两个核心问题展开的。资源定位的主要思想就是将 `工程路径` 转换为 `部署路径`，也就是把相对路径变成绝对路径并且加上md5戳和域名。这样做的目的是解决静态资源缓存更新的问题，同时为模块化开发这个问题做准备。因为只有将所有相对路径转换成绝对路径才能实现模块的独立性，模块才能被任何地方使用都不用担心里面资源加载的问题。你所喜欢的内嵌功能，也是要建立在路径转换的基础上，因为内嵌会改变路径关系，绝对化处理可以让任意文件间的内嵌成为可能。

模块化开发呢，在解决了资源定位的前提下，核心问题就是依赖管理和加载了。fis最推崇的做法就是：

> 尽量依靠框架实现，最少依赖构建工具处理。

就是说，尽量不要让构建工具做太多事情，因为那很黑盒，fis的设计是，构建工具只负责生成依赖关系表，这就足够了，然后框架自己决定什么时候该加载哪些资源，表的关系可以让框架加载时完成按需、请求合并等需求。

> 基于上述设计理念，能发挥fis最大价值的地方就在于如何利用静态资源依赖表来实现一个合理的模块化框架。

### 为什么要将相对路径转换成绝对路径

最常见的例子就是处理css合并了，css中经常会有图片资源的路径引用，如果保留相对路径，会对css文件合并带来很多负担。有这么几种情况：

1. 代码中使用相对路径，合并后不做任何路径处理。这种情况下，有两种开发模式：
   1. 所有css在同级维护，构建中合并css，并且合并后的css也是同级目录。优点是不依赖工具，简单直观。缺点是不能把css和对应的html、js维护在一起，而且项目变大之后一个目录下都是css文件，又不能分二级，很恶心。
   2. 所有css中写图片路径的时候，都是写那个合并后文件的相对路径。优点是css可以分级，但是写资源地址要时刻想着是在另外一个文件中使用的，这和写绝对路径有什么分别？而且IDE不友好，很多IDE会报错，别小看这个，很多程序员都是神经质，烦。
2. 代码中使用相对路径，合并后根据合并后生成的文件的位置做相对路径计算。解决了1.2中的问题，通过工具重新计算相对路径。缺点是同一个文件只能被合并，不能被其他方式复用，否则会带来相对路径不一致问题。而且这都用上工具了，为啥不直接转成绝对路径。
3. 代码中使用相对路径，合并后替换成绝对路径。先说缺点，依赖工具，没了。然后说说优点：
   1. 开发中使用相对路径，各种直观与友好
   2. 没有规范，组件任意移植，部署路径都能正确
   3. 目录任意分级，可以实现完全的组件化/模块化开发
   4. 有些时候，我们可能需要把css的文件嵌入到js中，通过js动态插入到页面上，或者嵌入到html的style标签中使用，转换成绝对路径永远不用担心资源找不到的情况
   5. combo随便，还是因为资源定位都是绝对路径。

js也有相同问题，当你在js中想要通过逻辑加载一个图片、加载一个css文件，加载其他js文件的时候，使用绝对路径可以让这个js无论在哪个页面，无论在哪一级路径下都能正确运行，有百利而无一害。（其实路径会很长，算是一害）。

有了绝对路径，资源的合并、复用、移动才能不被运行时的文档路径限制。我觉得，绝对路径才叫资源定位，才是真实的完整的定位信息，相对路径更像是一种“变量”，它使得同一段代码在不同的路径下执行会有可能发生定位错误。

其实前端页面也是一种GUI软件，传统的桌面软件，所有程序资源都部署（安装）在客户端，所以从来没有在资源上遇到过想前端的这种的定位概念。前端程序资源是部署在其他设备上的，通过运行时加载到客户端来执行，这种程序资源部署上的差异我觉得正是前端工程与GUI软件工程的最大区别，几乎所有前端开发、维护、模块化、性能优化等特殊的工程问题都是围绕着这个差异点产生的。

